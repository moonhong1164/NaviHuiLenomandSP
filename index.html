<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NAVI&HUI LENORMAND</title>
<style>
  :root{
    --bg:#f6efff;
    --card:#ffffff;
    --ink:#2b1560;
    --shadow:rgba(0,0,0,.12);
    --pill:#ffffff;
    --pill-on:#dff3ff;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    background:var(--bg);
    font-family:ui-sans-serif,system-ui,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
    color:var(--ink);
  }
  .wrap{
    max-width:960px;
    margin:0 auto;
    padding:20px;
  }
  h1{
    margin:8px 0 18px;
    text-align:center;
    font-size:34px;
    font-weight:800;
  }

  .toolbar{
    background:var(--pill);
    border-radius:18px;
    box-shadow:0 6px 20px var(--shadow);
    padding:14px 16px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
    justify-content:center;
  }
  .qbox{
    flex:1 1 260px;
    display:flex;
    gap:8px;
    align-items:center;
    font-size:14px;
  }
  .qbox input[type="text"]{
    flex:1;
    padding:10px 12px;
    border:1px solid #ded6f8;
    border-radius:12px;
    background:#fff;
  }
  .center-opt{
    display:flex;
    align-items:center;
    font-size:12px;
    gap:4px;
  }
  .center-opt select{
    padding:4px 6px;
    border-radius:10px;
    border:1px solid #ded6f8;
    background:#fff;
    font-size:12px;
  }
  .btn{
    border:0;
    padding:10px 16px;
    border-radius:14px;
    background:#fff;
    box-shadow:0 3px 12px var(--shadow);
    cursor:pointer;
    font-weight:700;
    font-size:14px;
  }
  .btn.on{background:var(--pill-on);}

  /* ğŸ”„ ì´ˆê¸°í™” ë²„íŠ¼ë§Œ ì‚´ì§ ë‹¤ë¥¸ ìƒ‰ìœ¼ë¡œ */
  .btn-reset{
    background:#ffeef3;
    border:1px solid #ffc4d8;
  }

  #stage{
    margin-top:18px;
    background:#fff;
    border-radius:16px;
    box-shadow:0 6px 18px var(--shadow);
    padding:16px;
  }

  /* ì¹´ë“œ ê³µí†µ */
  .item{text-align:center;cursor:pointer;}
  .card{
    width:120px;
    aspect-ratio:3/4;
    background:var(--card);
    border-radius:16px;
    box-shadow:0 4px 14px var(--shadow);
    display:flex;
    align-items:center;
    justify-content:center;
    margin:0 auto;
  }
  .card img{
    width:92%;
    height:auto;
    border-radius:10px;
  }
  .caption{
    margin-top:6px;
    font-size:13px;
    line-height:1.15;
  }
  .muted{opacity:.7;}
  .tone{
    display:inline-block;
    margin-top:4px;
    padding:3px 8px;
    border-radius:999px;
    font-size:12px;
  }
  .tone.pos{background:#e8f2ff;}
  .tone.neu{background:#e7ffe8;}
  .tone.neg{background:#ffe7e7;}

  /* í‚¤ì¹´ë“œ í•˜ì´ë¼ì´íŠ¸ */
  .keycard .card{
    box-shadow:0 0 0 3px #a855f7, 0 0 16px rgba(168,85,247,.5);
  }

  /* 1/2/3ì¹´ë“œ: ê°€ë¡œ ì¤„ */
  .row{
    display:flex;
    gap:14px;
    justify-content:center;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  /* 5ì¹´ë“œ */
  .spread-5{
    display:flex;
    gap:8px;
    justify-content:space-between;
    align-items:flex-start;
    flex-wrap:nowrap;
  }

  /* ì‹­ì ìŠ¤í”„ë ˆë“œ */
  .cross{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:12px;
    max-width:640px;
    margin:0 auto;
  }
  .cross .card{width:100%;max-width:150px;}

  /* 3x3 9ì¹´ë“œ */
  .grid3x3{
    display:grid;
    grid-template-columns:repeat(3,minmax(0,1fr));
    gap:10px;
    max-width:640px;
    margin:0 auto;
    justify-items:center;
  }

  /* ê·¸ë‘íƒ€ë¸”ë¡œ 8x4+4 */
  .gt8-row,
  .gt8-bottom{
    display:flex;
    gap:6px;
    justify-content:center;
    align-items:flex-start;
    flex-wrap:nowrap;
    margin-top:4px;
  }
  .gt8-bottom{margin-top:10px;}

  /* ê·¸ë‘íƒ€ë¸”ë¡œ 9x4 */
  .gt9-grid{
    display:grid;
    grid-template-columns:repeat(9,minmax(0,1fr));
    gap:6px;
    max-width:900px;
    margin:0 auto;
    justify-items:center;
  }

  .box{
    margin-top:14px;
    padding:12px;
    border:1px dashed #d7cfff;
    border-radius:12px;
    background:#fbf9ff;
  }
  .small{font-size:12px;line-height:1.35;}
  .list{margin:6px 0 0 0;padding-left:18px;}

  /* ëª¨ë°”ì¼ ìµœì í™” */
  @media (max-width:768px){
    .wrap{padding:16px;}
    h1{font-size:28px;}
    .card{width:100px;}
    .cross .card{max-width:140px;}

    .spread-5 .card{
      width:17vw;
      max-width:none;
    }
    .spread-5 .caption{
      font-size:11px;
    }

    .gt8-row .card,
    .gt8-bottom .card,
    .gt9-grid .card{
      width:80px;
    }
  }
  @media (max-width:480px){
    .card{width:90px;}
    .cross .card{max-width:120px;}
    .spread-5 .card{width:16vw;}

    .gt8-row .card,
    .gt8-bottom .card,
    .gt9-grid .card{
      width:70px;
    }
  }
</style>
</head>
<body>

<!-- ğŸ” ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í™”ë©´ -->
<div id="lock-screen" style="min-height:100vh;display:flex;align-items:center;justify-content:center;">
  <div style="background:#ffffff;border-radius:18px;box-shadow:0 8px 24px rgba(0,0,0,.16);padding:24px 20px;max-width:320px;width:90%;text-align:center;">
    <h2 style="margin:0 0 12px;font-size:20px;font-weight:800;color:#2b1560;">NAVI&amp;HUI LENORMAND</h2>
    <p style="margin:0 0 16px;font-size:14px;color:#555;">ì ‘ì† ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
    <input id="pw-input" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"
           style="width:100%;padding:10px 12px;border:1px solid #ded6f8;border-radius:10px;margin-bottom:12px;">
    <button id="pw-btn"
            style="width:100%;padding:10px 0;border:0;border-radius:10px;background:#7c5cff;color:#fff;font-weight:700;cursor:pointer;">
      ì…ì¥í•˜ê¸°
    </button>
    <p id="pw-error" style="margin-top:8px;font-size:12px;color:#d60000;display:none;">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</p>
  </div>
</div>

<!-- ğŸ”’ ì‹¤ì œ í˜ì´ì§€ ë‚´ìš© -->
<div id="app" style="display:none;">
  <div class="wrap">
    <h1>NAVI&HUI LENORMAND</h1>

    <div class="toolbar">
      <div class="qbox">
        <label><input id="useQ" type="checkbox" /> ì§ˆë¬¸ ì…ë ¥</label>
        <input id="qtext" type="text" placeholder="ì§ˆë¬¸ì„ ì ì–´ ì£¼ì„¸ìš”" />
      </div>

      <!-- ì¤‘ì•™ ì¹´ë“œ / í‚¤ì¹´ë“œ ì„ íƒ -->
      <div class="center-opt">
        <span>í‚¤ì¹´ë“œ</span>
        <select id="center-select">
          <option value="">ëœë¤</option>
        </select>
      </div>

      <button class="btn" onclick="drawN(1,this)">1ì¹´ë“œ</button>
      <button class="btn" onclick="drawN(2,this)">2ì¹´ë“œ</button>
      <button class="btn" onclick="drawN(3,this)">3ì¹´ë“œ</button>
      <button class="btn" onclick="drawN(5,this)">5ì¹´ë“œ</button>
      <button class="btn" onclick="drawCross(this)">+ ì‹­ì</button>
      <button class="btn" onclick="draw3x3(this)">9ì¹´ë“œ(3x3)</button>
      <button class="btn" onclick="drawGT8x4(this)">ê·¸ë‘íƒ€ë¸”ë¡œ 8x4+4</button>
      <button class="btn" onclick="drawGT9x4(this)">ê·¸ë‘íƒ€ë¸”ë¡œ 9x4</button>
      <button class="btn btn-reset" onclick="resetAll()">ì´ˆê¸°í™”</button>
    </div>

    <div id="stage"></div>
  </div>
</div>

<script>
/* ğŸ–± ì˜¤ë¥¸ìª½ í´ë¦­ ë°©ì§€ */
document.addEventListener("contextmenu", function(e){
  e.preventDefault();
});

/* ===== ì¹´ë“œ ë°ì´í„° ===== */
const CARDS = [
  {num:1, code:"Rider",   kr:"ê¸°ìˆ˜",   key:"ì†Œì‹â€¢ì´ë™",   add:"ë¹ ë¥¸ ë³€í™”Â·ì—°ë½ ë„ì°©", type:"neutral"},
  {num:2, code:"Clover",  kr:"í´ë¡œë²„", key:"í–‰ìš´â€¢ê¸°íšŒ",   add:"ì§§ì€ ì°¬ìŠ¤Â·ì‹œë„ ì¢‹ìŒ", type:"negative"},
  {num:3, code:"Ship",    kr:"ì„ ë°•",   key:"ì—¬í–‰â€¢í™•ì¥",   add:"ê´€ê³„Â·í™˜ê²½ ë³€í™”",     type:"neutral"},
  {num:4, code:"House",   kr:"ì§‘",     key:"ê°€ì •â€¢ì•ˆì •",   add:"ê¸°ë°˜ ë‹¤ì§€ê¸°",       type:"neutral"},
  {num:5, code:"Tree",    kr:"ë‚˜ë¬´",   key:"ê±´ê°•â€¢ì„±ì¥",   add:"ì¥ê¸° ì„±ì¥Â·íšŒë³µ",     type:"neutral"},
  {num:6, code:"Cloud",   kr:"êµ¬ë¦„",   key:"í˜¼ë€â€¢ë¶ˆí™•ì‹¤", add:"íŒë‹¨ ë³´ë¥˜Â·ì±™ê¸°ê¸°",   type:"positive"},
  {num:7, code:"Snake",   kr:"ë±€",     key:"ìœ í˜¹â€¢ê¸°ë§Œ",   add:"ê²‰ê³¼ì† ë‹¤ë¦„Â·ì£¼ì˜",   type:"positive"},
  {num:8, code:"Coffin",  kr:"ê´€",     key:"ëâ€¢ì „í™˜",     add:"ì •ë¦¬Â·ì¬ì¶œë°œ",       type:"positive"},
  {num:9, code:"Bouquet", kr:"ë¶€ì¼€",   key:"ì„ ë¬¼â€¢ê¸°ì¨",   add:"í˜¸ì˜ ìƒìŠ¹",         type:"negative"},
  {num:10,code:"Scythe",  kr:"ë‚«",     key:"ë‹¨ì ˆâ€¢ê²°ì •",   add:"ë¹ ë¥¸ ì„ íƒ",         type:"positive"},
  {num:11,code:"Whip",    kr:"ì±„ì°",   key:"ê°ˆë“±â€¢ë°˜ë³µ",   add:"ë£¨í”„ ëŠê¸°",         type:"positive"},
  {num:12,code:"Bird",    kr:"ìƒˆ",     key:"ëŒ€í™”â€¢ì†Œë¬¸",   add:"ë§ ë§ì€ ì‹œê¸°",       type:"neutral"},
  {num:13,code:"Child",   kr:"ì•„ì´",   key:"ìƒˆ ì‹œì‘â€¢ìˆœìˆ˜", add:"ì‘ì§€ë§Œ ì„±ì¥ í¼",     type:"negative"},
  {num:14,code:"Fox",     kr:"ì—¬ìš°",   key:"ì¼â€¢ì˜ì‹¬",     add:"ê³„ì•½Â·ì •ë³´ ì¬í™•ì¸",   type:"neutral"},
  {num:15,code:"Bear",    kr:"ê³°",     key:"í˜â€¢ë³´í˜¸",     add:"í›„ì›Â·ë¦¬ë”ì‹­",       type:"neutral"},
  {num:16,code:"Stars",   kr:"ë³„",     key:"í¬ë§â€¢ëª©í‘œ",   add:"ë¹„ì „ ëª…í™•",         type:"negative"},
  {num:17,code:"Stork",   kr:"í™©ìƒˆ",   key:"ë³€í™”â€¢ê°œì„ ",   add:"ìŠµê´€ ì—…ë°ì´íŠ¸",     type:"neutral"},
  {num:18,code:"Dog",     kr:"ê°œ",     key:"ì‹ ë¢°â€¢ìš°ì •",   add:"ë™ë§¹Â·íŒŒíŠ¸ë„ˆì‹­",     type:"negative"},
  {num:19,code:"Tower",   kr:"íƒ‘",     key:"ì œë„â€¢ë…ë¦½",   add:"í™€ë¡œì„œê¸°",         type:"neutral"},
  {num:20,code:"Garden",  kr:"ì •ì›",   key:"ëª¨ì„â€¢ê³µê°œ",   add:"ì¢‹ì€ í‰íŒ",         type:"neutral"},
  {num:21,code:"Mountain",kr:"ì‚°",     key:"ì¥ì• â€¢ì§€ì—°",   add:"ì‹œê°„ í•„ìš”",         type:"positive"},
  {num:22,code:"Crossroad",kr:"ê°ˆë¦¼ê¸¸",key:"ì„ íƒâ€¢ê²°ì •",   add:"ë°ì´í„° ë¹„êµ",       type:"neutral"},
  {num:23,code:"Mice",    kr:"ì¥",     key:"ì†ì‹¤â€¢ì†Œëª¨",   add:"ë¯¸ì„¸ëˆ„ìˆ˜ ì ê²€",     type:"positive"},
  {num:24,code:"Heart",   kr:"í•˜íŠ¸",   key:"ì‚¬ë‘â€¢ê°ì •",   add:"ê°ì • íšŒë³µ",         type:"negative"},
  {num:25,code:"Ring",    kr:"ë°˜ì§€",   key:"ê³„ì•½â€¢ìˆœí™˜",   add:"ì¥ê¸° ì»¤ë°‹",         type:"negative"},
  {num:26,code:"Book",    kr:"ì±…",     key:"ë¹„ë°€â€¢í•™ìŠµ",   add:"ì •ë³´ ë¯¸ê³µê°œ",       type:"neutral"},
  {num:27,code:"Letter",  kr:"í¸ì§€",   key:"ì—°ë½â€¢ë¬¸ì„œ",   add:"ì¦ê±°Â·í†µë³´",         type:"neutral"},
  {num:28,code:"Man",     kr:"ë‚¨ì„±",   key:"í•µì‹¬ ì¸ë¬¼",   add:"ì¤‘ì‹¬ ë‚¨ì„±",         type:"neutral"},
  {num:29,code:"Woman",   kr:"ì—¬ì„±",   key:"í•µì‹¬ ì¸ë¬¼",   add:"ì¤‘ì‹¬ ì—¬ì„±",         type:"neutral"},
  {num:30,code:"Lily",    kr:"ë°±í•©",   key:"í‰í™”â€¢ì„±ìˆ™",   add:"íœ´ì‹Â·í’ˆìœ„",         type:"neutral"},
  {num:31,code:"Sun",     kr:"íƒœì–‘",   key:"ì„±ê³µâ€¢í™œë ¥",   add:"ê¸ì • ê²°ê³¼",         type:"negative"},
  {num:32,code:"Moon",    kr:"ë‹¬",     key:"ëª…ì˜ˆâ€¢ê°ì •",   add:"ê°ì • ë¦¬ë“¬",         type:"negatvie"},
  {num:33,code:"Key",     kr:"ì—´ì‡ ",   key:"í•´ê²°â€¢ì •ë‹µ",   add:"ëŒíŒŒêµ¬",           type:"negative"},
  {num:34,code:"Fish",    kr:"ë¬¼ê³ ê¸°", key:"ì¬ë¬¼â€¢êµë¥˜",   add:"ê±°ë˜ ì¦ê°€",         type:"negative"},
  {num:35,code:"Anchor",  kr:"ë‹»",     key:"ì•ˆì •â€¢ê³ ì •",   add:"ì§€ì†ì„±",           type:"negative"},
  {num:36,code:"Cross",   kr:"ì‹­ìê°€", key:"ê³ ë‚œâ€¢ì‹ ë…",   add:"ì±…ì„Â·ë²„í‹°ê¸°",       type:"positive"},
];

/* í‚¤ì¹´ë“œ ì…€ë ‰íŠ¸ ì´ˆê¸°í™” */
function initCenterSelect(){
  const sel = document.getElementById("center-select");
  if(!sel) return;
  CARDS.forEach(c=>{
    const opt = document.createElement("option");
    opt.value = String(c.num);
    opt.textContent = `${c.num}. ${c.code}`;
    sel.appendChild(opt);
  });
}
document.addEventListener("DOMContentLoaded", initCenterSelect);

/* ì´ë¯¸ì§€ ë¡œë”© */
const IMG_DIR_CANDIDATES = ["","cards/","images/","img/"];
const IMG_EXT_CANDIDATES = [".png",".webp",".jpg",".PNG",".JPG"];
const pad2 = n => String(n).padStart(2,"0");

function makeImg(num){
  const img = document.createElement("img");
  img.dataset.num = num;
  img.dataset.try = 0;
  img.src = encodeURI(`ë ˆë…¸ë¨¼ë“œ-${pad2(num)}.png`);
  img.onerror = function(){ tryNextImg(this); };
  return img;
}
function tryNextImg(img){
  let t = +img.dataset.try;
  const num = img.dataset.num;
  const total = IMG_DIR_CANDIDATES.length * IMG_EXT_CANDIDATES.length;
  if(t >= total){ img.onerror = null; return; }
  const dir = IMG_DIR_CANDIDATES[Math.floor(t / IMG_EXT_CANDIDATES.length)];
  const ext = IMG_EXT_CANDIDATES[t % IMG_EXT_CANDIDATES.length];
  img.dataset.try = t + 1;
  img.src = encodeURI(`${dir}ë ˆë…¸ë¨¼ë“œ-${pad2(num)}${ext}`);
}

/* ìœ í‹¸ */
function toneBadge(type){
  if(type === "negative") return '<span class="tone pos">ğŸ”µ ê¸ì •</span>';
  if(type === "positive") return '<span class="tone neg">ğŸ”´ ë¶€ì •</span>';
  return '<span class="tone neu">ğŸŸ¢ ì¤‘ë¦½</span>';
}

function makeTile(card, onClick=null, showCaption=true, extraClass=""){
  const root = document.createElement("div");
  root.className = "item" + (extraClass ? " "+extraClass : "");

  const cardDiv = document.createElement("div");
  cardDiv.className = "card";
  cardDiv.appendChild(makeImg(card.num));
  root.appendChild(cardDiv);

  if(showCaption){
    const cap = document.createElement("div");
    cap.className = "caption";
    cap.innerHTML =
      `<b>${card.num}. ${card.code}</b><br>`+
      `${toneBadge(card.type)}<br>`+
      `${card.key}<br>`+
      `<span class="muted">${card.add}</span>`;
    root.appendChild(cap);
  }

  if(onClick) root.onclick = onClick;
  return root;
}

function shuffle(arr){
  return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);
}

function setOn(btn){
  document.querySelectorAll(".btn").forEach(b=>b.classList.remove("on"));
  if(btn) btn.classList.add("on");
}

function questionHTML(){
  const use = document.getElementById("useQ").checked;
  const q = document.getElementById("qtext").value.trim();
  if(!use || !q) return "";
  return `<div class="box small"><b>ì§ˆë¬¸:</b> ${q}</div>`;
}

/* í†¤ ìš”ì•½ */
function summarize(cards){
  const score = {positive:0,negative:0,neutral:0};
  cards.forEach(c => { score[c.type]++; });
  const top = Object.entries(score).sort((a,b)=>b[1]-a[1])[0][0];

  let toneTxt = "";
  let interp = "";
  let advice = "";
  if(top === "negative"){
    toneTxt = "ğŸ”µ ê¸ì •";
    interp = "ì „ë°˜ì ìœ¼ë¡œ íë¦„ì´ ìš°í˜¸ì ì…ë‹ˆë‹¤. ì¶”ì§„/í™•ëŒ€Â·íšŒë³µÂ·í•©ì˜ì˜ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.";
    advice = "ê¸°íšŒê°€ ì™”ì„ ë•Œ ê³¼ê°íˆ ì¡ë˜, ì¼ì •/ì¡°ê±´ì„ ëª…í™•íˆ í•˜ê³  ì‹¤í–‰í•˜ì„¸ìš”.";
  }else if(top === "positive"){
    toneTxt = "ğŸ”´ ë¶€ì •";
    interp = "ê²½ê³  ì‹ í˜¸ê°€ ëšœë ·í•©ë‹ˆë‹¤. ë‹¨ì ˆ/ì§€ì—°/ì†Œëª¨ ì´ìŠˆì— ëŒ€ë¹„ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
    advice = "ë¬´ë¦¬í•œ í™•ì¥ì€ í”¼í•˜ê³  ë¦¬ìŠ¤í¬ ê´€ë¦¬Â·ì •ë¦¬Â·ë³´ìˆ˜ì  ì„ íƒì„ ìš°ì„ í•˜ì„¸ìš”.";
  }else{
    toneTxt = "ğŸŸ¢ ì¤‘ë¦½";
    interp = "ìƒí™©ì´ ì—‡ê°ˆë¦½ë‹ˆë‹¤. ì„œë‘ë¥´ê¸°ë³´ë‹¤ ì •ë³´ í™•ì¸ì´ ìš°ì„ ì…ë‹ˆë‹¤.";
    advice = "ì˜µì…˜ì„ ë¹„êµÂ·ê²€ì¦í•œ ë’¤ ì‘ê²Œ ì‹œì‘í•˜ê±°ë‚˜ ìœ ë³´í•˜ëŠ” ì „ëµì´ ìœ ë¦¬í•©ë‹ˆë‹¤.";
  }
  return {toneTxt, interp, advice};
}

/* ===== ìŠ¤í”„ë ˆë“œë³„ í•´ì„ ===== */

function chainSentence(a,b){
  return `ã€Œ${a.kr} + ${b.kr}ã€ ì²´ì¸: ${a.key} ìœ„ì— ${b.key}ê°€ ì´ì–´ì§€ë©°, ${a.add} íë¦„ ì†ì— ${b.add}ê°€ ë”í•´ì§€ëŠ” ì¡°í•©ì…ë‹ˆë‹¤.`;
}

/* 1/2/3/5ì¹´ë“œ í•´ì„ */
function interpretN(n,cards){
  if(!cards || !cards.length) return "";

  if(n === 1){
    const c = cards[0];
    return `
<div class="box small">
  <b>1ì¹´ë“œ í•´ì„ ê°€ì´ë“œ</b>
  <ul class="list">
    <li>ì´ë²ˆ ë¦¬ë”© ì „ì²´ë¥¼ ëŒ€í‘œí•˜ëŠ” <b>í•µì‹¬ í…Œë§ˆ ì¹´ë“œ</b>ì…ë‹ˆë‹¤.</li>
    <li>í‚¤ì›Œë“œ: <b>${c.key}</b></li>
    <li>ë©”ì‹œì§€: ${c.add}</li>
    <li>ê¸ì •/ë¶€ì •, ì˜¤ëŠ˜ì˜ ì „ë°˜ì ì¸ íë¦„ì„ ê°€ë³ê²Œ ì²´í¬í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
  </ul>
</div>`;
  }

  if(n === 2){
    const [a,b] = cards;
    return `
<div class="box small">
  <b>2ì¹´ë“œ í•´ì„ ê°€ì´ë“œ</b>
  <ul class="list">
    <li>ì™¼ìª½ ì¹´ë“œ <b>${a.kr}</b> : ì§€ê¸ˆ ìƒí™©Â·ë°°ê²½, ê¸°ë³¸ì ì¸ íë¦„</li>
    <li>ì˜¤ë¥¸ìª½ ì¹´ë“œ <b>${b.kr}</b> : ê·¸ì— ëŒ€í•œ ì „ê°œ ë°©í–¥ í˜¹ì€ ëŒ€ì‘ ë°©ì‹</li>
  </ul>
  <b>ì²´ì¸ìœ¼ë¡œ ë³´ê¸°</b>
  <ul class="list">
    <li>${chainSentence(a,b)}</li>
  </ul>
  <p class="small">ë‘ ì¹´ë“œë¥¼ í•˜ë‚˜ì˜ ë¬¸ì¥ìœ¼ë¡œ ì´ì–´ì„œ, â€œì§€ê¸ˆ ìƒí™©ì€ â€¦ë¼ì„œ â€¦í•˜ê²Œ í˜ëŸ¬ê°„ë‹¤â€ëŠ” ì‹ìœ¼ë¡œ ì •ë¦¬í•´ ë³´ì„¸ìš”.</p>
</div>`;
  }

  if(n === 3){
    const [c1,c2,c3] = cards;
    return `
<div class="box small">
  <b>3ì¹´ë“œ ë¼ì¸ í•´ì„ ê°€ì´ë“œ</b>
  <ul class="list">
    <li>2ë²ˆ ì¹´ë“œ <b>${c2.kr}</b>ê°€ ë¦¬ë”©ì˜ <b>í•µì‹¬ ë¶„ìœ„ê¸°Â·ì£¼ì œ</b>ì…ë‹ˆë‹¤.</li>
    <li>1ë²ˆ ì¹´ë“œ <b>${c1.kr}</b>ëŠ” ì§€ê¸ˆì— ì´ë¥´ê¸°ê¹Œì§€ì˜ íë¦„, 3ë²ˆ ì¹´ë“œ <b>${c3.kr}</b>ëŠ” ì•ìœ¼ë¡œ ì´ì–´ì§ˆ íë¦„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</li>
  </ul>
  <b>ì¡°í•©Â·ì²´ì¸ìœ¼ë¡œ ì½ê¸°</b>
  <ul class="list">
    <li>1+2 (<b>${c1.kr} â†’ ${c2.kr}</b>) : í˜„ì¬ ìƒí™©ì— ì˜í–¥ì„ ì¤€ <b>ë°°ê²½Â·ì›ì¸</b></li>
    <li>2+3 (<b>${c2.kr} â†’ ${c3.kr}</b>) : ì§€ê¸ˆ ì´í›„ë¡œ ì´ì–´ì§ˆ <b>ì „ê°œÂ·ê²°ê³¼</b></li>
    <li>1+3 (<b>${c1.kr} â†’ ${c3.kr}</b>) : ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚˜ì§€ ì•Šì€ <b>ë¶€ì—° ì„¤ëª…Â·ìˆ¨ì€ ë§¥ë½</b></li>
  </ul>
  <p class="small">ì„¸ ì¥ì˜ í•µì‹¬ ì˜ë¯¸ë¥¼ ëª¨ì•„ â€œì§€ê¸ˆ ìƒí™©ì€ â€¦ë¼ì„œ, ì•ìœ¼ë¡œ â€¦í•˜ê²Œ í˜ëŸ¬ê°„ë‹¤â€ë¼ëŠ” í•˜ë‚˜ì˜ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•´ ë³´ì„¸ìš”.</p>
</div>`;
  }

  if(n === 5){
    const [c1,c2,c3,c4,c5] = cards;
    return `
<div class="box small">
  <b>5ì¹´ë“œ ë¼ì¸ í•´ì„ ê°€ì´ë“œ</b>
  <ul class="list">
    <li>3ë²ˆ ì¹´ë“œ <b>${c3.kr}</b> : <b>ë¬¸ì œì˜ ì¤‘ì‹¬</b>, ì§ˆë¬¸ìì˜ í˜„ì¬ ìƒíƒœ</li>
    <li>1+2 (<b>${c1.kr} â†’ ${c2.kr}</b>) : 3ë²ˆ ì¹´ë“œê°€ ìƒê¸°ê²Œ ëœ <b>ì›ì¸Â·ë°°ê²½</b></li>
    <li>4+5 (<b>${c4.kr} â†’ ${c5.kr}</b>) : ì•ìœ¼ë¡œ ë‚˜íƒ€ë‚  <b>ê²°ê³¼Â·ì •ë¦¬ ë°©í–¥</b></li>
  </ul>
  <b>ê²½ì²©(ë¼ì¸) êµ¬ì¡°ë¡œ ë³´ëŠ” ì¡°í•©</b>
  <ul class="list">
    <li>1+2+4 : ì£¼ì œì˜ ì„±ê²©ì„ ë” ê¹Šê²Œ ë¬˜ì‚¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë³´ì¡° ì¡°í•©</li>
    <li>1+5 : ë¦¬ë”© ì „ì²´ë¥¼ í•œ ì¤„ë¡œ ìš”ì•½í•  ë•Œ ì°¸ê³ í•˜ëŠ” ì‹œì‘â€“ê²°ë§ ì¶•</li>
    <li>1+3, 2+4, 3+5 : ê²‰ìœ¼ë¡œ ë§í•˜ì§€ ì•Šì€ <b>ë§ˆì°°Â·ìˆ¨ì€ ì´ìœ Â·ë³´ì´ì§€ ì•ŠëŠ” ë™ê¸°</b>ë¥¼ ë³¼ ë•Œ í™œìš©</li>
  </ul>
  <p class="small">3ë²ˆ ì¹´ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì•(1Â·2)ê³¼ ë’¤(4Â·5)ë¥¼ ë¹„êµí•˜ë©´, â€œì™œ ì´ëŸ° ì¼ì´ ìƒê²¼ê³  ì–´ë””ë¡œ í–¥í•˜ëŠ”ì§€â€ê°€ ì„ ëª…í•´ì§‘ë‹ˆë‹¤.</p>
</div>`;
  }

  return "";
}

/* ì‹­ì ìŠ¤í”„ë ˆë“œ í•´ì„ */
function interpretCross(cards){
  if(!cards || cards.length < 5) return "";
  const top    = cards[0];
  const left   = cards[1];
  const center = cards[2];
  const right  = cards[3];
  const bottom = cards[4];

  return `
<div class="box small">
  <b>ì‹­ì ìŠ¤í”„ë ˆë“œ í•´ì„ ê°€ì´ë“œ</b>
  <ul class="list">
    <li><b>ì¤‘ì‹¬ (${center.kr})</b> : ì§ˆë¬¸ì ë˜ëŠ” ì£¼ì œì˜ <b>í˜„ì¬ ìƒí™©Â·í•µì‹¬</b></li>
    <li><b>ìœ„ (${top.kr})</b> : ì˜ì‹í•˜ê³  ìˆëŠ” ê²ƒ, ë™ê¸°, ê³„íšÂ·ìƒê°Â·ê±±ì • ë“± <b>ë¨¸ë¦¿ì† ì˜ì—­</b></li>
    <li><b>ì•„ë˜ (${bottom.kr})</b> : ê·¼ë³¸, ë°”íƒ•ì´ ë˜ëŠ” ê²ƒ, <b>ë¬´ì˜ì‹ì ì¸ ë™ê¸°</b></li>
    <li><b>ì™¼ìª½ (${left.kr})</b> : ê³¼ê±°, ì‚¬ê±´ì˜ ê³„ê¸°, ì¡°ê±´ ë“± <b>ì´ë¯¸ ì§€ë‚˜ê°„ ì˜í–¥</b></li>
    <li><b>ì˜¤ë¥¸ìª½ (${right.kr})</b> : ì•ìœ¼ë¡œ ì „ê°œë  <b>ë¯¸ë˜Â·ê°€ëŠ¥í•œ ê²°ê³¼</b></li>
  </ul>
  <b>í¬ë¡œìŠ¤ ì¡°í•©ìœ¼ë¡œ ì „ì²´ íë¦„ ì¡ê¸°</b>
  <ul class="list">
    <li>1+4+3 (ì™¼ìª½â€“ìœ„â€“ì˜¤ë¥¸ìª½) : ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚˜ëŠ” ì „ê°œ ë°©í–¥</li>
    <li>4+1+5 (ìœ„â€“ì™¼ìª½â€“ì•„ë˜) : ê³¼ê±° ë™ê¸°ì—ì„œ ë¹„ë¡¯ëœ í˜„ì¬ì˜ ë¿Œë¦¬</li>
    <li>1+5+3 (ì™¼ìª½â€“ì•„ë˜â€“ì˜¤ë¥¸ìª½) : ê°ì •ì  íë¦„ê³¼ ê²°ê³¼</li>
    <li>4+3+5 (ìœ„â€“ì˜¤ë¥¸ìª½â€“ì•„ë˜) : ë¨¸ë¦¿ì† ê¸°ëŒ€ì™€ ì‹¤ì œ ê²°ê³¼ì˜ ê°„ê·¹</li>
  </ul>
  <p class="small">ê°€ë¡œì¤„(ì™¼Â·ì¤‘Â·ì˜¤)ê³¼ ì„¸ë¡œì¤„(ìœ„Â·ì¤‘Â·ì•„ë˜)ì„ ê°ê° 3ì¹´ë“œ ë¼ì¸ì²˜ëŸ¼ ì½ê³ , ìœ„ ì¡°í•©ë“¤ë¡œ ë‹¤ì‹œ í•œ ë²ˆ êµì°¨ ì ê²€í•˜ë©´ ì „ì²´ ë¦¬ë”©ì˜ ë°©í–¥ì„ ì•ˆì •ì ìœ¼ë¡œ ì¡ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</div>`;
}

/* 3x3 9ì¹´ë“œ í•´ì„ */
function interpret3x3(order){
  if(!order || order.length < 9) return "";

  const c1 = order[0], c2 = order[1], c3 = order[2];
  const c4 = order[3], c5 = order[4], c6 = order[5];
  const c7 = order[6], c8 = order[7], c9 = order[8];

  const topRowNames    = [c1.kr, c2.kr, c3.kr].join(" - ");
  const bottomRowNames = [c7.kr, c8.kr, c9.kr].join(" - ");
  const leftColNames   = [c1.kr, c4.kr, c7.kr].join(" - ");
  const rightColNames  = [c3.kr, c6.kr, c9.kr].join(" - ");
  const diag159        = [c1.kr, c5.kr, c9.kr].join(" - ");
  const diag357        = [c3.kr, c5.kr, c7.kr].join(" - ");

  const sel = document.getElementById("center-select");
  const hasSignificator = sel && sel.value && sel.value !== "";

  return `
<div class="box small">
  <b>3x3 9ì¹´ë“œ í•´ì„ ê°€ì´ë“œ</b><br>
  ì¤‘ì•™ ì¹´ë“œ <b>${c5.kr}</b>ê°€ ì´ë²ˆ ë¦¬ë”©ì˜ <b>ì¤‘ì‹¬ í…Œë§ˆ</b>ì…ë‹ˆë‹¤.${hasSignificator ? " (í‚¤ì¹´ë“œë¥¼ ì„ íƒí–ˆë‹¤ë©´, ì‘ì€ ê·¸ë‘ íƒ€ë¸”ë¡œì²˜ëŸ¼ <b>í‘œì§€ì/ì£¼ì œ ì¹´ë“œ</b>ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.)" : ""}

  <ul class="list">
    <li><b>1â€“2â€“3 (${topRowNames})</b> : ìƒê°Â·ì˜ì‹ì˜ ì˜ì—­ â€” ë™ê¸°, ê³„íš, ë¨¸ë¦¿ì† ê±±ì •</li>
    <li><b>7â€“8â€“9 (${bottomRowNames})</b> : ê°ì •Â·ë¬´ì˜ì‹ì˜ ì˜ì—­ â€” ê·¼ë³¸, ë°”íƒ•ì´ ë˜ëŠ” ê°ì •</li>
    <li><b>1â€“4â€“7 (${leftColNames})</b> : ê³¼ê±°Â·ì‚¬ê±´ì˜ ë™ê¸°ë‚˜ ê³„ê¸°</li>
    <li><b>3â€“6â€“9 (${rightColNames})</b> : ë¯¸ë˜Â·ê°€ëŠ¥í•œ ê²°ê³¼</li>
  </ul>

  <b>ëŒ€ê°ì„ ìœ¼ë¡œ ì¤‘ì‹¬ í…Œë§ˆì˜ ì„±ì§ˆ ë³´ê¸°</b>
  <ul class="list">
    <li>1â€“5â€“9 (${diag159}) : ì¤‘ì‹¬ í…Œë§ˆê°€ <b>ë°”ê¹¥ ìƒí™©ê³¼ ì–´ë–»ê²Œ ì—°ê²°ë˜ëŠ”ì§€</b></li>
    <li>3â€“5â€“7 (${diag357}) : ì¤‘ì‹¬ í…Œë§ˆê°€ <b>ë‚´ë©´Â·ê°ì •ê³¼ ì–´ë–»ê²Œ ì–½í˜€ ìˆëŠ”ì§€</b></li>
  </ul>

  <p class="small">
    ê° ì¤„(ê°€ë¡œÂ·ì„¸ë¡œÂ·ëŒ€ê°ì„ )ì„ 3ì¹´ë“œ ë¼ì¸ì²˜ëŸ¼ í•˜ë‚˜ì˜ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í•˜ê³ ,
    íŠ¹íˆ ì¤‘ì•™ ì¹´ë“œ ${c5.kr}ì„ ê¸°ì¤€ìœ¼ë¡œ â€œì•(1Â·4Â·7)â€ê³¼ â€œë’¤(3Â·6Â·9)â€ì˜ ëŒ€ë¹„ë¥¼ ì‚´í”¼ë©´
    ê³¼ê±°ì—ì„œ ë¯¸ë˜ë¡œ ì´ì–´ì§€ëŠ” íë¦„ì´ ë” ë˜ë ·í•´ì§‘ë‹ˆë‹¤.
  </p>
</div>`;
}

/* ê·¸ë‘íƒ€ë¸”ë¡œ 8x4+4 í•´ì„ */
function interpretGT8x4(order, keyNum){
  let html = `
<div class="box small">
  <b>ê·¸ë‘íƒ€ë¸”ë¡œ 8x4+4 í•´ì„ ê°€ì´ë“œ</b>
  <ul class="list">
    <li>36ì¥ì„ ëª¨ë‘ ì‚¬ìš©í•˜ëŠ” ëŒ€í˜• ìŠ¤í”„ë ˆë“œì…ë‹ˆë‹¤.</li>
    <li>ìœ„ì—ì„œë¶€í„° ë„¤ ì¤„(ê° 8ì¥)ì€ <b>í˜„ì¬Â·ì£¼ë³€ í™˜ê²½Â·ì¤‘Â·ì¥ê¸°ì  íë¦„</b>ì„, ë§¨ ì•„ë˜ 4ì¥ì€ <b>ìš´ëª…/ì´ì •ë¦¬ ë¼ì¸</b>ìœ¼ë¡œ ë´…ë‹ˆë‹¤.</li>
    <li>ê°€ë¡œì¤„, ì„¸ë¡œì¤„, ëŒ€ê°ì„ , ê¸°ì‚¬ ì´ë™(ë‘ ì¹¸+í•œ ì¹¸) ë“±ìœ¼ë¡œ ì„¸ë¶€ íë¦„ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  </ul>
`;

  if(!keyNum){
    html += `
  <p class="small">
    í‚¤ì¹´ë“œë¥¼ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ”, ê° ì¤„ê³¼ ì¹´ë“œ ë­‰ì¹˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì „ì²´ ë¶„ìœ„ê¸°Â·ê³¼ê±°ì™€ ë¯¸ë˜ì˜ ì¶•ì„ ë‚˜ëˆ„ì–´ ì½ìŠµë‹ˆë‹¤.
    ì‚¬ëŒ ì¹´ë“œ(28/29)ê°€ ì–´ë””ì— ìˆëŠ”ì§€, íƒœì–‘Â·ë³„Â·ì—´ì‡ Â·ì‹­ìê°€ ë“± ê°•í•œ ì¹´ë“œê°€ ì–´ëŠ ì¤„ì— ëª¨ì—¬ ìˆëŠ”ì§€ë„ í•¨ê»˜ ì‚´í´ë³´ë©´ ì¢‹ìŠµë‹ˆë‹¤.
  </p>
</div>`;
    return html;
  }

  const idx = order.findIndex(c => c.num === keyNum);
  if(idx === -1){
    html += `<p class="small">ì„ íƒí•œ í‚¤ì¹´ë“œë¥¼ ë°°ì—´ì—ì„œ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì •ìƒ ë°°ì¹˜ë¼ë©´ 36ì¥ ì•ˆì— ë°˜ë“œì‹œ í¬í•¨ë©ë‹ˆë‹¤.)</p></div>`;
    return html;
  }

  const keyCard = order[idx];
  const house = idx + 1;
  let zone = "";
  if(house <= 8) zone = "1í–‰ â€” ê²‰ìœ¼ë¡œ ë³´ì´ëŠ” í˜„ì¬ ìƒí™©Â·ì™¸ë¶€ í™˜ê²½";
  else if(house <= 16) zone = "2í–‰ â€” ê°€ê¹Œìš´ ë¯¸ë˜, ì£¼ë³€ ì‚¬ëŒë“¤ì˜ ì˜í–¥";
  else if(house <= 24) zone = "3í–‰ â€” ì¤‘Â·ì¥ê¸° íë¦„, ë‚´ë©´ê³¼ í˜„ì‹¤ì„ ì‡ëŠ” ì˜ì—­";
  else if(house <= 32) zone = "4í–‰ â€” ê²°ê³¼Â·ì •ë¦¬ ë‹¨ê³„, ì´ì•¼ê¸°ê°€ ì–´ë””ë¡œ ê·€ê²°ë˜ëŠ”ì§€";
  else zone = "ë§¨ ì•„ë˜ 4ì¥ â€” ìš´ëª…/ì´ì •ë¦¬ ë¼ì¸, ì „ì²´ ë¦¬ë”©ì˜ ê²°ë¡ ";

  html += `
  <ul class="list">
    <li>í‚¤ì¹´ë“œ <b>${keyCard.kr} (${keyCard.num})</b>ëŠ” <b>${house}ë²ˆ í•˜ìš°ìŠ¤</b>, <b>${zone}</b>ì— ìœ„ì¹˜í•©ë‹ˆë‹¤.</li>
    <li>í‚¤ì¹´ë“œ ê¸°ì¤€ ì™¼ìª½ ì¹´ë“œë“¤ì€ <b>ì´ë¯¸ ì§€ë‚˜ê°„ ì¼Â·ê³¼ê±°ì˜ ì˜í–¥</b>ì„, ì˜¤ë¥¸ìª½ ì¹´ë“œë“¤ì€ <b>ì•ìœ¼ë¡œ ë“¤ì–´ì˜¬ ìƒí™©Â·ë¯¸ë˜</b>ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</li>
    <li>í‚¤ì¹´ë“œ ìœ„ìª½ ì¤„ì€ <b>ë¨¸ë¦¬Â·ì˜ì‹Â·ê³„íš</b>, ì•„ë˜ìª½ ì¤„ì€ <b>ê°ì •Â·í˜„ì‹¤ì ì¸ ê²°ê³¼Â·ëª¸ì˜ ë°˜ì‘</b>ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  </ul>
  <p class="small">
    ì‹¤ì „ì—ì„œëŠ” í‚¤ì¹´ë“œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°€ë¡œì¤„(ê³¼ê±°â†’ë¯¸ë˜), ì„¸ë¡œì¤„(ìœ„â†’ì•„ë˜), ëŒ€ê°ì„ , ê°€ê¹Œì´ ëª¨ì—¬ ìˆëŠ” ì¹´ë“œ ë­‰ì¹˜ë¥¼
    3ì¹´ë“œ ì²´ì¸ì²˜ëŸ¼ ì´ì–´ì„œ ë¬¸ì¥ìœ¼ë¡œ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤.  
    ì˜ˆë¥¼ ë“¤ì–´ â€œì™¼ìª½ ë‘ ì¥ì€ ê³¼ê±°ì˜ ê³„ê¸°, ì˜¤ë¥¸ìª½ ë‘ ì¥ì€ ì•ìœ¼ë¡œì˜ ì „ê°œ, í‚¤ì¹´ë“œ ë°”ë¡œ ìœ„/ì•„ë˜ëŠ”
    ì´ ìƒí™©ì— ëŒ€í•œ ë¨¸ë¦¬ì™€ ë§ˆìŒì˜ ë°˜ì‘â€ì²˜ëŸ¼ êµ¬ë¶„í•´ ì½ì–´ ì£¼ì„¸ìš”.
  </p>
</div>`;

  return html;
}

/* ê·¸ë‘íƒ€ë¸”ë¡œ 9x4 í•´ì„ */
function interpretGT9x4(order, keyNum){
  let html = `
<div class="box small">
  <b>ê·¸ë‘íƒ€ë¸”ë¡œ 9x4 í•´ì„ ê°€ì´ë“œ</b>
  <ul class="list">
    <li>4í–‰Ã—9ì—´ë¡œ 36ì¥ì„ ëª¨ë‘ í¼ì¹˜ëŠ” ìŠ¤í”„ë ˆë“œì…ë‹ˆë‹¤.</li>
    <li>ìƒë‹¨ ë‘ ì¤„ì€ <b>í˜„ì¬Â·ê°€ê¹Œìš´ ë¯¸ë˜</b>, í•˜ë‹¨ ë‘ ì¤„ì€ <b>ì¤‘Â·ì¥ê¸° ì „ë§Â·ê¹Šì€ ë¬´ì˜ì‹</b>ìœ¼ë¡œ ë³´ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.</li>
    <li>ì„¸ë¡œì—´ì€ ì£¼ì œë³„(ê´€ê³„Â·ì¼Â·ì¬ì •Â·ë‚´ë©´ ë“±) íë¦„ì„, ê°€ë¡œì¤„ì€ ì‹œê°„ì˜ íë¦„(ê³¼ê±°â†’ë¯¸ë˜)ìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  </ul>
`;

  if(!keyNum){
    html += `
  <p class="small">
    í‚¤ì¹´ë“œë¥¼ ì§€ì •í•˜ì§€ ì•Šì•˜ë‹¤ë©´, ì‚¬ëŒ ì¹´ë“œ(28/29)ê°€ ìˆëŠ” ì¤„ê³¼ ì—´ì„ ê¸°ì¤€ìœ¼ë¡œ ê´€ê³„ íë¦„ì„ ë³´ê³ ,
    íƒœì–‘Â·ë³„Â·ì—´ì‡ Â·ì‹­ìê°€ ë“±ì˜ ìœ„ì¹˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì¤‘ìš”í•œ ì‚¬ê±´ì˜ ì¶•ì„ ì¡ì•„ì¤ë‹ˆë‹¤.
  </p>
</div>`;
    return html;
  }

  const idx = order.findIndex(c => c.num === keyNum);
  if(idx === -1){
    html += `<p class="small">ì„ íƒí•œ í‚¤ì¹´ë“œë¥¼ ë°°ì—´ì—ì„œ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p></div>`;
    return html;
  }

  const keyCard = order[idx];
  const row = Math.floor(idx / 9) + 1;
  const col = (idx % 9) + 1;

  function getCardAt(r,c){
    if(r < 1 || r > 4 || c < 1 || c > 9) return null;
    return order[(r-1)*9 + (c-1)];
  }

  const left   = getCardAt(row, col-1);
  const right  = getCardAt(row, col+1);
  const up     = getCardAt(row-1, col);
  const down   = getCardAt(row+1, col);
  const upLeft = getCardAt(row-1, col-1);
  const upRight= getCardAt(row-1, col+1);
  const dnLeft = getCardAt(row+1, col-1);
  const dnRight= getCardAt(row+1, col+1);

  html += `
  <ul class="list">
    <li>í‚¤ì¹´ë“œ <b>${keyCard.kr} (${keyCard.num})</b>ëŠ” <b>${row}í–‰ ${col}ì—´</b>ì— ìœ„ì¹˜í•©ë‹ˆë‹¤.</li>
    <li>ê°™ì€ ì¤„(${row}í–‰)ì˜ ì™¼ìª½ ì¹´ë“œë“¤ì€ <b>ê³¼ê±°Â·ì´ë¯¸ ì§€ë‚˜ê°„ íë¦„</b>, ì˜¤ë¥¸ìª½ ì¹´ë“œë“¤ì€ <b>ì•ìœ¼ë¡œ ì „ê°œë  ìƒí™©</b>ì„ ë§í•©ë‹ˆë‹¤.</li>
    <li>í‚¤ì¹´ë“œ ìœ„ìª½(${row-1}í–‰)ì€ <b>ë¨¸ë¦¿ì† ìƒê°Â·ê³„íšÂ·ì´ì„±ì  íŒë‹¨</b>, ì•„ë˜ìª½(${row+1}í–‰)ì€ <b>ê°ì •Â·ëª¸ì˜ ë°˜ì‘Â·í˜„ì‹¤ ê²°ê³¼</b>ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
  </ul>

  <b>í‚¤ì¹´ë“œ ì£¼ë³€ ì¹´ë“œ í•´ì„ ì˜ˆì‹œ</b>
  <ul class="list">
    ${left   ? `<li>ì™¼ìª½ (${left.kr}) : ê³¼ê±°ì˜ ê³„ê¸°Â·ê¸°ë°˜</li>` : ""}
    ${right  ? `<li>ì˜¤ë¥¸ìª½ (${right.kr}) : ê³§ ë‹¤ê°€ì˜¬ ì¼Â·êµ¬ì²´ì ì¸ ì „ê°œ</li>` : ""}
    ${up     ? `<li>ìœ„ (${up.kr}) : ë¨¸ë¦¬ë¡œ ìƒê°í•˜ëŠ” ë°”Â·ì˜ì‹ì ì¸ ëª©í‘œ</li>` : ""}
    ${down   ? `<li>ì•„ë˜ (${down.kr}) : ë¬´ì˜ì‹Â·ê°ì •Â·ì‹¤ì œ ë°˜ì‘</li>` : ""}
    ${upLeft ? `<li>ì™¼ìª½ ìœ„ (${upLeft.kr}) : ê³¼ê±°ì˜ ìƒê°Â·ë¨¸ë¦¿ì†ì— ë‚¨ì€ ê¸°ì–µ</li>` : ""}
    ${upRight? `<li>ì˜¤ë¥¸ìª½ ìœ„ (${upRight.kr}) : ì•ìœ¼ë¡œ ê¸°ëŒ€í•˜ëŠ” ì¼Â·í¬ë§</li>` : ""}
    ${dnLeft ? `<li>ì™¼ìª½ ì•„ë˜ (${dnLeft.kr}) : ê³¼ê±° ì‚¬ê±´ì´ ë‚¨ê¸´ ê°ì •Â·ì—¬íŒŒ</li>` : ""}
    ${dnRight? `<li>ì˜¤ë¥¸ìª½ ì•„ë˜ (${dnRight.kr}) : ì•ìœ¼ë¡œ ê°ì •ì ìœ¼ë¡œ ì–´ë–¤ ì˜í–¥ì´ ë‚¨ëŠ”ì§€</li>` : ""}
  </ul>

  <p class="small">
    ì‹¤ì „ì—ì„œëŠ” í‚¤ì¹´ë“œê°€ ìˆëŠ” ì¤„ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì¢Œìš°ë¥¼ â€œê³¼ê±°â€“í˜„ì¬â€“ë¯¸ë˜â€ì˜ í•œ ë¬¸ì¥ìœ¼ë¡œ ë§Œë“¤ê³ ,
    ìœ„Â·ì•„ë˜Â·ëŒ€ê°ì„  ì¹´ë“œë¥¼ 3ì¹´ë“œ ì²´ì¸ì²˜ëŸ¼ ë§ë¶™ì—¬ì„œ
    â€œì§ˆë¬¸ìê°€ ì–´ë–»ê²Œ ìƒê°í•˜ê³  ëŠë¼ë©°, ì•ìœ¼ë¡œ ë¬´ì—‡ì„ ê²½í—˜í• ì§€â€ë¥¼ ì •ë¦¬í•´ ì£¼ë©´ ìì—°ìŠ¤ëŸ½ê²Œ ê·¸ë‘íƒ€ë¸”ë¡œ ë¦¬ë”©ì´ ì™„ì„±ë©ë‹ˆë‹¤.
  </p>
</div>`;

  return html;
}

/* ë©”ì¸ ìŠ¤í…Œì´ì§€ */
const stage = document.getElementById("stage");

/* Nì¥ (1,2,3,5) */
function drawN(n,btn){
  setOn(btn);
  const pick = shuffle([...CARDS]).slice(0,n);
  stage.innerHTML = "";
  stage.insertAdjacentHTML("beforeend", questionHTML());

  if(n === 5){
    const row = document.createElement("div");
    row.className = "spread-5";
    pick.forEach(c => row.appendChild(makeTile(c)));
    stage.appendChild(row);

    const sum = summarize(pick);
    stage.insertAdjacentHTML("beforeend",
      `<div class="box small"><b>5ì¹´ë“œ ìš”ì•½</b><br>`+
      `ì „ì²´ í†¤: ${sum.toneTxt}<br>`+
      `í•´ì„: ${sum.interp}<br>`+
      `ê¶Œê³ : ${sum.advice}</div>`
    );
    stage.insertAdjacentHTML("beforeend", interpretN(5,pick));
  }else{
    const row = document.createElement("div");
    row.className = "row";
    pick.forEach(c => row.appendChild(makeTile(c)));
    stage.appendChild(row);
    stage.insertAdjacentHTML("beforeend", interpretN(n,pick));
  }
}

/* ì‹­ì ìŠ¤í”„ë ˆë“œ */
function drawCross(btn){
  setOn(btn);
  const cs = shuffle([...CARDS]).slice(0,5);
  stage.innerHTML = "";
  stage.insertAdjacentHTML("beforeend", questionHTML());

  const g = document.createElement("div");
  g.className = "cross";
  g.appendChild(document.createElement("div"));
  g.appendChild(makeTile(cs[0]));
  g.appendChild(document.createElement("div"));
  g.appendChild(makeTile(cs[1]));
  g.appendChild(makeTile(cs[2]));
  g.appendChild(makeTile(cs[3]));
  g.appendChild(document.createElement("div"));
  g.appendChild(makeTile(cs[4]));
  g.appendChild(document.createElement("div"));
  stage.appendChild(g);

  stage.insertAdjacentHTML("beforeend", interpretCross(cs));
}

/* 3x3 9ì¹´ë“œ */
function draw3x3(btn){
  setOn(btn);
  stage.innerHTML = "";
  stage.insertAdjacentHTML("beforeend", questionHTML());

  const sel = document.getElementById("center-select");
  const chosenVal = sel ? sel.value : "";
  const deck = [...CARDS];
  let centerCard = null;
  let others = [];

  if(chosenVal){
    const chosenNum = parseInt(chosenVal,10);
    const idx = deck.findIndex(c => c.num === chosenNum);
    if(idx !== -1){
      centerCard = deck.splice(idx,1)[0];
    }
    const shuffled = shuffle(deck);
    others = shuffled.slice(0,8);
  }else{
    const shuffled = shuffle(deck);
    const nine = shuffled.slice(0,9);
    centerCard = nine[4];
    others = nine.filter((_,i)=>i!==4);
  }

  const order = [];
  let oi = 0;
  for(let i=0;i<9;i++){
    if(i === 4){
      order.push(centerCard);
    }else{
      order.push(others[oi++]);
    }
  }

  const grid = document.createElement("div");
  grid.className = "grid3x3";
  order.forEach(c => grid.appendChild(makeTile(c)));
  stage.appendChild(grid);

  const sum = summarize(order);
  stage.insertAdjacentHTML("beforeend",
    `<div class="box small"><b>9ì¹´ë“œ(3x3) ìš”ì•½</b><br>`+
    `ì „ì²´ í†¤: ${sum.toneTxt}<br>`+
    `í•´ì„: ${sum.interp}<br>`+
    `ê¶Œê³ : ${sum.advice}</div>`
  );
  stage.insertAdjacentHTML("beforeend", interpret3x3(order));
}

/* ê·¸ë‘íƒ€ë¸”ë¡œ 8x4+4 */
function drawGT8x4(btn){
  setOn(btn);
  const deck = shuffle([...CARDS]); // 36ì¥ ì „ì²´ ì‚¬ìš©
  const sel = document.getElementById("center-select");
  const keyVal = sel && sel.value ? parseInt(sel.value,10) : null;

  stage.innerHTML = "";
  stage.insertAdjacentHTML("beforeend", questionHTML());

  const wrap = document.createElement("div");

  // ìœ„ 4ì¤„ (8ì¥ì”©)
  for(let r=0;r<4;r++){
    const rowDiv = document.createElement("div");
    rowDiv.className = "gt8-row";
    for(let c=0;c<8;c++){
      const card = deck[r*8 + c];
      const isKey = keyVal && card.num === keyVal;
      rowDiv.appendChild(makeTile(card,null,false,isKey ? "keycard" : ""));
    }
    wrap.appendChild(rowDiv);
  }

  // ì•„ë˜ 4ì¥
  const bottom = document.createElement("div");
  bottom.className = "gt8-bottom";
  for(let i=32;i<36;i++){
    const card = deck[i];
    const isKey = keyVal && card.num === keyVal;
    bottom.appendChild(makeTile(card,null,false,isKey ? "keycard" : ""));
  }
  wrap.appendChild(bottom);
  stage.appendChild(wrap);

  const sum = summarize(deck);
  stage.insertAdjacentHTML("beforeend",
    `<div class="box small"><b>ê·¸ë‘íƒ€ë¸”ë¡œ 8x4+4 í†¤ ìš”ì•½</b><br>`+
    `ì „ì²´ í†¤: ${sum.toneTxt}<br>`+
    `í•´ì„: ${sum.interp}<br>`+
    `ê¶Œê³ : ${sum.advice}</div>`
  );
  stage.insertAdjacentHTML("beforeend", interpretGT8x4(deck,keyVal));
}

/* ê·¸ë‘íƒ€ë¸”ë¡œ 9x4 */
function drawGT9x4(btn){
  setOn(btn);
  const deck = shuffle([...CARDS]); // 36ì¥ ì „ì²´
  const sel = document.getElementById("center-select");
  const keyVal = sel && sel.value ? parseInt(sel.value,10) : null;

  stage.innerHTML = "";
  stage.insertAdjacentHTML("beforeend", questionHTML());

  const grid = document.createElement("div");
  grid.className = "gt9-grid";

  for(let i=0;i<36;i++){
    const card = deck[i];
    const isKey = keyVal && card.num === keyVal;
    grid.appendChild(makeTile(card,null,false,isKey ? "keycard" : ""));
  }
  stage.appendChild(grid);

  const sum = summarize(deck);
  stage.insertAdjacentHTML("beforeend",
    `<div class="box small"><b>ê·¸ë‘íƒ€ë¸”ë¡œ 9x4 í†¤ ìš”ì•½</b><br>`+
    `ì „ì²´ í†¤: ${sum.toneTxt}<br>`+
    `í•´ì„: ${sum.interp}<br>`+
    `ê¶Œê³ : ${sum.advice}</div>`
  );
  stage.insertAdjacentHTML("beforeend", interpretGT9x4(deck,keyVal));
}

/* ğŸ”„ ì´ˆê¸°í™” */
function resetAll(){
  setOn(null);
  if(stage) stage.innerHTML = "";
  const qInput = document.getElementById("qtext");
  const qCheck = document.getElementById("useQ");
  if(qInput) qInput.value = "";
  if(qCheck) qCheck.checked = false;
  const sel = document.getElementById("center-select");
  if(sel) sel.value = "";
}

/* ğŸ” ë¹„ë°€ë²ˆí˜¸ ì ê¸ˆ */
(function(){
  const PASSWORD = "gnskgnsk";

  const lock  = document.getElementById("lock-screen");
  const app   = document.getElementById("app");
  const input = document.getElementById("pw-input");
  const btn   = document.getElementById("pw-btn");
  const error = document.getElementById("pw-error");

  function unlock(){
    const val = input.value.trim();
    if(val === PASSWORD){
      lock.style.display = "none";
      app.style.display  = "block";
      error.style.display = "none";
      input.value = "";
    }else{
      error.style.display = "block";
    }
  }

  btn.addEventListener("click", unlock);
  input.addEventListener("keydown", e=>{
    if(e.key === "Enter") unlock();
  });
})();
</script>
</body>
</html>
